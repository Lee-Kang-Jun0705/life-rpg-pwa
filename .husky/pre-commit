#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# 스테이징된 파일만 검사
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$')

if [ -n "$STAGED_FILES" ]; then
  echo "🔍 ESLint 검사 중..."
  
  # ESLint 실행
  npx eslint $STAGED_FILES --fix
  
  # 수정된 파일 다시 스테이징
  git add $STAGED_FILES
  
  # 오류 체크
  npx eslint $STAGED_FILES
  
  if [ $? -ne 0 ]; then
    echo "❌ ESLint 오류가 발견되었습니다. 커밋이 중단됩니다."
    echo "📌 'npm run lint:fix'를 실행하여 자동 수정을 시도하세요."
    exit 1
  fi
fi

echo "✅ Pre-commit 검사 통과!"