#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# ìŠ¤í…Œì´ì§•ëœ íŒŒì¼ë§Œ ê²€ì‚¬
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$')

if [ -n "$STAGED_FILES" ]; then
  echo "ğŸ” ESLint ê²€ì‚¬ ì¤‘..."
  
  # ESLint ì‹¤í–‰
  npx eslint $STAGED_FILES --fix
  
  # ìˆ˜ì •ëœ íŒŒì¼ ë‹¤ì‹œ ìŠ¤í…Œì´ì§•
  git add $STAGED_FILES
  
  # ì˜¤ë¥˜ ì²´í¬
  npx eslint $STAGED_FILES
  
  if [ $? -ne 0 ]; then
    echo "âŒ ESLint ì˜¤ë¥˜ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì»¤ë°‹ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤."
    echo "ğŸ“Œ 'npm run lint:fix'ë¥¼ ì‹¤í–‰í•˜ì—¬ ìë™ ìˆ˜ì •ì„ ì‹œë„í•˜ì„¸ìš”."
    exit 1
  fi
fi

echo "âœ… Pre-commit ê²€ì‚¬ í†µê³¼!"