import { db } from './index'

/**
 * ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì™„ì „íˆ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
 * ì£¼ì˜: ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤!
 */
export async function resetDatabase() {
  try {
    console.log('ğŸ”„ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹œì‘...')
    
    // ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œ
    await db.delete()
    console.log('âœ… ê¸°ì¡´ ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œ ì™„ë£Œ')
    
    // ë°ì´í„°ë² ì´ìŠ¤ ì¬ìƒì„±
    await db.open()
    console.log('âœ… ìƒˆ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± ì™„ë£Œ')
    
    return true
  } catch (error) {
    console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨:', error)
    return false
  }
}

/**
 * ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ë””ë²„ê·¸ í•¨ìˆ˜
 */
export async function debugDatabase() {
  if (process.env.NODE_ENV !== 'development') {
    console.warn('âš ï¸ debugDatabaseëŠ” ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.')
    return
  }
  
  try {
    const version = await db.verno
    console.log(`ğŸ“Š í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ ë²„ì „: ${version}`)
    
    const tables = db.tables.map(table => table.name)
    console.log('ğŸ“‹ í…Œì´ë¸” ëª©ë¡:', tables)
    
    // ê° í…Œì´ë¸”ì˜ ë ˆì½”ë“œ ìˆ˜ í™•ì¸
    for (const table of db.tables) {
      const count = await table.count()
      console.log(`  - ${table.name}: ${count}ê°œ ë ˆì½”ë“œ`)
    }
  } catch (error) {
    console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ë””ë²„ê·¸ ì‹¤íŒ¨:', error)
  }
}

// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì „ì—­ ê°ì²´ì— ì¶”ê°€
if (typeof window !== 'undefined' && process.env.NODE_ENV === 'development') {
  (window as any).__resetDatabase = resetDatabase
  (window as any).__debugDatabase = debugDatabase
  console.log('ğŸ’¡ ê°œë°œì ë„êµ¬ ì½˜ì†”ì—ì„œ ì‚¬ìš© ê°€ëŠ¥:')
  console.log('  - __resetDatabase() : ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”')
  console.log('  - __debugDatabase() : ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸')
}